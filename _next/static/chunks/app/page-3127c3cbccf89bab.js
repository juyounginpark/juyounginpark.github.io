(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9020:function(t,e,n){Promise.resolve().then(n.bind(n,2090))},2090:function(t,e,n){"use strict";n.d(e,{default:function(){return f}});var a=n(4973),r=n(2265),o=n(9376);n(3550);let i={leftMin:15,leftMax:85,bottomMin:35,bottomMax:80},s=[{left:26,bottom:23.299999999999997},{left:30,bottom:23.299999999999997},{left:34,bottom:23.299999999999997},{left:28,bottom:20.299999999999997},{left:32,bottom:20.299999999999997}],l=["\uD83D\uDE0A","\uD83D\uDE01","\uD83D\uDE12","\uD83D\uDE0D","\uD83E\uDD23","\uD83E\uDEE3","\uD83D\uDE21","\uD83D\uDE18","\uD83D\uDE36‍\uD83C\uDF2B️","\uD83D\uDE31","\uD83D\uDE93","\uD83C\uDF2D","\uD83D\uDCBF","\uD83E\uDD77","\uD83D\uDC69‍\uD83C\uDF73","\uD83E\uDDD1‍\uD83C\uDF84","\uD83D\uDEA8","\uD83E\uDDDC‍♂️","\uD83E\uDD55","\uD83C\uDF46"],u=(t,e)=>Math.random()*(e-t)+t,c=(t,e,n,a)=>(t-n)*(t-n)+(e-a)*(e-a);function m(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,e=[];for(let n=0;n<t;n++){let t=l[n%l.length],a=u(.8,1.2),r=4*a,o=!1;for(let s=0;s<200;s++){let s=u(i.leftMin+r,i.leftMax-r),l=u(i.bottomMin+r,i.bottomMax-r),m=!1;for(let t of e){let e=(r+t.radius)**2;if(c(s,l,t.left,t.bottom)<e){m=!0;break}}if(!m){e.push({id:"e_".concat(Date.now(),"_").concat(n,"_").concat(Math.random().toString(36).slice(2,7)),char:t,left:s,bottom:l,scale:a,radius:r,state:"onTree",fresh:!0}),o=!0;break}}if(!o){let o=.8*r;for(let r=0;r<200;r++){let r=u(i.leftMin+o,i.leftMax-o),s=u(i.bottomMin+o,i.bottomMax-o),l=!1;for(let t of e){let e=(o+t.radius)**2;if(c(r,s,t.left,t.bottom)<e){l=!0;break}}if(!l){e.push({id:"e_".concat(Date.now(),"_").concat(n,"_").concat(Math.random().toString(36).slice(2,7)),char:t,left:r,bottom:s,scale:a,radius:o,state:"onTree",fresh:!0});break}}}}return e}function f(){let t=(0,o.useRouter)(),[e,n]=r.useState(!1),i=r.useRef({t:0,x:0,y:0}),[l,u]=r.useState(()=>m(20)),c=r.useRef(l);r.useEffect(()=>{c.current=l},[l]);let f=r.useRef({}),d=r.useRef({}),b=r.useRef({}),p=r.useRef({}),k=r.useRef({}),[D,h]=r.useState(!1),[g,w]=r.useState(!1),[x,v]=r.useState(!1),E=r.useMemo(()=>l.filter(t=>"inBasket"===t.state||"toBasket"===t.state).length,[l]),C=e&&!g,T=r.useCallback(()=>{let e=c.current.filter(t=>"inBasket"===t.state||"toBasket"===t.state).map(t=>t.char),n=e.length>0?"?emojis=".concat(encodeURIComponent(e.join(","))):"";t.push("/result".concat(n))},[t,c]),B=r.useCallback((t,e)=>{u(n=>n.map(n=>n.id===t?{...n,...e}:n))},[]),F=r.useCallback(()=>{u(t=>t.filter(t=>"inBasket"!==t.state&&"toBasket"!==t.state))},[]),y=r.useCallback(t=>{u(e=>{let n=e.find(e=>e.id===t);return n&&("onTree"===n.state||"wobble"===n.state)?e.map(e=>e.id===t?{...e,state:"wobble"}:e):e}),d.current[t]&&window.clearTimeout(d.current[t]),d.current[t]=window.setTimeout(()=>{B(t,{state:"onTree"}),delete d.current[t]},800)},[B]),S=r.useCallback(t=>{u(e=>{let n=new Set;for(let t of e)("inBasket"===t.state||"toBasket"===t.state)&&null!=t.slotIndex&&n.add(t.slotIndex);let a=null;for(let t=0;t<5;t++)if(!n.has(t)){a=t;break}return null==a?e:e.map(e=>{if(e.id!==t)return e;let n=s[a];return{...e,state:"toBasket",slotIndex:a,left:n.left,bottom:n.bottom}})})},[]),M=r.useCallback(t=>{let e=c.current.find(e=>e.id===t);if(!e||"onTree"!==e.state&&"wobble"!==e.state||E>=5)return;let n=e.bottom;u(e=>e.map(e=>e.id===t?{...e,state:"falling",vy:0}:e));let a=n,r=0,o=e=>{if(null==p.current[t]){p.current[t]=e,b.current[t]=requestAnimationFrame(o);return}let n=(e-p.current[t])/1e3;if(p.current[t]=e,r+=-220*n,(a+=r*n)<=15){a=15,u(e=>e.map(e=>e.id===t?{...e,bottom:a,vy:0,state:"ground"}:e)),cancelAnimationFrame(b.current[t]),delete b.current[t],delete p.current[t],window.setTimeout(()=>S(t),500);return}let i=a,s=r;u(e=>e.map(e=>e.id===t?{...e,bottom:i,vy:s}:e)),b.current[t]=requestAnimationFrame(o)};b.current[t]=requestAnimationFrame(o)},[S,E]),A=r.useCallback(t=>{let e=c.current.find(e=>e.id===t);if(!e||"onTree"!==e.state&&"wobble"!==e.state)return;let n=e.bottom;u(e=>e.map(e=>e.id===t?{...e,state:"falling",vy:0}:e));let a=n,r=0,o=e=>{if(null==p.current[t]){p.current[t]=e,b.current[t]=requestAnimationFrame(o);return}let n=(e-p.current[t])/1e3;if(p.current[t]=e,r+=-220*n,(a+=r*n)<=15){a=15,u(e=>e.map(e=>e.id===t?{...e,bottom:a,vy:0,state:"ground"}:e)),cancelAnimationFrame(b.current[t]),delete b.current[t],delete p.current[t],k.current[t]&&clearTimeout(k.current[t]),k.current[t]=window.setTimeout(()=>{u(e=>e.map(e=>e.id===t?{...e,state:"removed"}:e)),delete k.current[t]},1e3);return}let i=a,s=r;u(e=>e.map(e=>e.id===t?{...e,bottom:i,vy:s}:e)),b.current[t]=requestAnimationFrame(o)};b.current[t]=requestAnimationFrame(o)},[]),j=r.useCallback((t,e)=>{let n=c.current.find(e=>e.id===t);if(!n)return;let a=null!=e?e:n.bottom+(x?20:0),r=0;u(e=>e.map(e=>e.id===t?{...e,state:"falling",bottom:a,vy:0}:e));let o=e=>{if(null==p.current[t]){p.current[t]=e,b.current[t]=requestAnimationFrame(o);return}let n=(e-p.current[t])/1e3;if(p.current[t]=e,r+=-220*n,(a+=r*n)<=15){a=15,u(e=>e.map(e=>e.id===t?{...e,bottom:a,vy:0}:e)),cancelAnimationFrame(b.current[t]),delete b.current[t],delete p.current[t],window.setTimeout(()=>{u(e=>e.map(e=>e.id===t?{...e,state:"removed"}:e))},200);return}let i=a;u(e=>e.map(e=>e.id===t?{...e,bottom:i}:e)),b.current[t]=requestAnimationFrame(o)};b.current[t]=requestAnimationFrame(o)},[x]),R=r.useCallback(()=>{let t=c.current.filter(t=>"inBasket"===t.state||"toBasket"===t.state).map(t=>t.id);0!==t.length&&(g||(w(!0),v(!0),window.setTimeout(()=>{h(!0);let e=c.current;t.forEach(t=>{let n=e.find(e=>e.id===t);n&&j(t,n.bottom+20)}),window.setTimeout(()=>{h(!1),v(!1),w(!1),F()},700)},420)))},[g,F,j]),I=r.useCallback(()=>{if(e)return;n(!0),window.setTimeout(()=>n(!1),2e3);let t=c.current.filter(t=>"onTree"===t.state||"wobble"===t.state).map(t=>t.id);window.setTimeout(()=>{t.forEach(t=>A(t))},2e3),window.setTimeout(()=>{u(t=>[...t.filter(t=>"inBasket"===t.state||"toBasket"===t.state),...m(20)])},4e3)},[e,A]),_=r.useCallback(()=>{I()},[I]),z=r.useCallback(t=>{let e=t.changedTouches[0],n=Date.now(),a=n-i.current.t,r=e.clientX-i.current.x,o=e.clientY-i.current.y;a<=300&&r*r+o*o<=576?(t.preventDefault(),I(),i.current={t:0,x:0,y:0}):i.current={t:n,x:e.clientX,y:e.clientY}},[I]),N=r.useCallback((t,e)=>{u(t=>t.map(t=>t.id===e&&"toBasket"===t.state?{...t,state:"inBasket"}:t))},[]),X=r.useCallback(t=>{let e=c.current.find(e=>e.id===t);e&&"inBasket"!==e.state&&"toBasket"!==e.state&&y(t)},[y]),q=r.useCallback(t=>{let e=c.current.find(e=>e.id===t);e&&"inBasket"!==e.state&&"toBasket"!==e.state&&M(t)},[M]),H=r.useCallback((t,e)=>{let n=c.current.find(e=>e.id===t);if(!n||"inBasket"===n.state||"toBasket"===n.state)return;let a=e.changedTouches[0],r=f.current[t]||{t:0,x:0,y:0},o=Date.now(),i=o-r.t,s=a.clientX-r.x,l=a.clientY-r.y;i<=300&&s*s+l*l<=576?(e.preventDefault(),M(t),f.current[t]={t:0,x:0,y:0}):(y(t),f.current[t]={t:o,x:a.clientX,y:a.clientY})},[M,y]);return r.useEffect(()=>{c.current.filter(t=>"onTree"===t.state||"wobble"===t.state).map(t=>t.id).forEach(t=>A(t)),window.setTimeout(()=>{u(t=>[...t.filter(t=>"inBasket"===t.state||"toBasket"===t.state),...m(20)])},2e3)},[A]),r.useEffect(()=>()=>{Object.values(d.current).forEach(t=>window.clearTimeout(t)),Object.values(k.current).forEach(t=>window.clearTimeout(t)),Object.values(b.current).forEach(t=>cancelAnimationFrame(t))},[]),(0,a.BX)("div",{css:{position:"fixed",inset:0,display:"grid",placeItems:"center",background:"#fff",overflow:"hidden"},children:[(0,a.BX)("div",{css:{position:"relative",aspectRatio:String(.809),width:"min(100vw, calc(100svh * ".concat(.809,"))"),overflow:"hidden"},children:[(0,a.tZ)("img",{src:"/images/tree.png",alt:"tree",draggable:!1,onDoubleClick:_,onTouchStart:z,className:"tree ".concat(e?"shake":""),css:{position:"absolute",inset:0,width:"100%",height:"100%",objectFit:"contain",objectPosition:"center",cursor:"pointer",userSelect:"none",WebkitTapHighlightColor:"transparent",zIndex:1}}),(0,a.tZ)("div",{className:e?"fruit-layer shake":"fruit-layer",css:{position:"absolute",inset:0,zIndex:3,pointerEvents:"none"},children:l.filter(t=>"removed"!==t.state&&"inBasket"!==t.state&&"toBasket"!==t.state).map(t=>{let n=e&&("onTree"===t.state||"wobble"===t.state);return(0,a.tZ)("div",{role:"button","aria-label":"emoji",onClick:()=>X(t.id),onDoubleClick:()=>q(t.id),onTouchStart:e=>H(t.id,e),onTransitionEnd:e=>N(e,t.id),className:["emoji","wobble"===t.state?"wobble":"",n?"tree-rotate":"",t.fresh?"fresh-grow":""].join(" ").trim(),css:{position:"absolute",left:"".concat(t.left,"%"),bottom:"".concat(t.bottom,"%"),fontSize:"calc(min(8vw, 48px) * ".concat(t.scale.toFixed(2),")"),lineHeight:1,transform:"translate(-50%, 0)",transformOrigin:"50% 70%",userSelect:"none",WebkitTapHighlightColor:"transparent",outline:"none",cursor:"pointer",pointerEvents:"auto",zIndex:3},children:t.char},t.id)})}),(0,a.tZ)("img",{src:"/images/basket.png",alt:"basket",draggable:!1,onClick:R,className:"basket ".concat(D?"flip":""," ").concat(C?"sway":""),css:{position:"absolute",left:"".concat(30,"%"),bottom:"".concat(x?33:13,"%"),transform:"translateX(-50%)",width:"30%",aspectRatio:"1",objectFit:"contain",userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:E>0?"pointer":"default",transition:"bottom ".concat(420,"ms ease"),zIndex:2}}),l.filter(t=>"inBasket"===t.state||"toBasket"===t.state).map(t=>{let e=t.bottom+(x?20:0),n="left 0.8s ease, bottom ".concat(420,"ms ease, transform ").concat(420,"ms ease");return(0,a.tZ)("div",{role:"button","aria-label":"emoji",onTransitionEnd:e=>N(e,t.id),className:["emoji",C?"in-basket-sway":"","in-basket"].join(" ").trim(),css:{position:"absolute",left:"".concat(t.left,"%"),bottom:"".concat(e,"%"),fontSize:"calc(min(8vw, 48px) * ".concat(t.scale.toFixed(2),")"),lineHeight:1,transform:"translate(-50%, 0)",transformOrigin:"50% 70%",userSelect:"none",WebkitTapHighlightColor:"transparent",outline:"none",cursor:"default",pointerEvents:"none",transition:n,zIndex:3},children:t.char},t.id)}),(0,a.tZ)("img",{src:"/images/basket_front.png",alt:"basket front",draggable:!1,className:"basket ".concat(D?"flip":""," ").concat(C?"sway":""),css:{position:"absolute",left:"".concat(30,"%"),bottom:"".concat(x?33:13,"%"),transform:"translateX(-50%)",width:"30%",aspectRatio:"1",objectFit:"contain",userSelect:"none",WebkitTapHighlightColor:"transparent",pointerEvents:"none",transition:"bottom ".concat(420,"ms ease"),zIndex:4}})]}),5===E&&(0,a.tZ)("button",{onClick:T,className:"confirm-button",css:{position:"absolute",top:"90%",left:"50%",transform:"translate(-50%, -50%)",zIndex:10,padding:"10px 40px",font:'600 clamp(16px, 2.5vw, 22px)/1.4 "DungGeunMo", sans-serif',color:"#fff",background:"#E53E3E",border:"none",borderRadius:"12px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.2)",cursor:"pointer",transition:"background 0.2s","&:hover":{background:"#C53030"}},children:"확인"}),(0,a.BX)("div",{css:{position:"fixed",bottom:"2svh",left:"50%",transform:"translateX(-50%)",zIndex:10,color:"#fff",font:'400 clamp(12px, 2.2vw, 18px)/1.4 "DungGeunMo", -apple-system, Roboto, Helvetica, Arial, sans-serif',background:"rgba(0,0,0,0.6)",padding:"6px 10px",borderRadius:"6px"},children:["나무를 ",(0,a.tZ)("b",{children:"더블탭"}),"하여 새로고침"]})]})}},3550:function(){}},function(t){t.O(0,[662,552,971,117,744],function(){return t(t.s=9020)}),_N_E=t.O()}]);